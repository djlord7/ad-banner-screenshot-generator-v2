<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ad Banner Screenshot Generator</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>Ad Banner Screenshot Generator</h1>
            <p>Automated screenshot generation for in-game advertising</p>
            <button id="push-all-btn" class="btn btn-success" style="position: absolute; top: 20px; right: 160px; display: none;">
                üöÄ Push <span id="pending-count">0</span> Live
            </button>
            <button id="settings-btn" class="btn btn-secondary" style="position: absolute; top: 20px; right: 20px;">üîì Enable Dev Mode</button>
        </header>

        <!-- Passcode Modal -->
        <div id="passcode-modal" class="modal" style="display: none;">
            <div class="modal-content">
                <h2>üîí Developer Access</h2>
                <p>Enter the 6-digit passcode to access settings:</p>
                <div class="form-group">
                    <input type="password" id="passcode-input" class="form-control" placeholder="Enter 6-digit code" maxlength="6" pattern="[0-9]{6}" inputmode="numeric">
                </div>
                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button id="verify-passcode-btn" class="btn btn-primary">Unlock</button>
                    <button id="cancel-passcode-btn" class="btn btn-secondary">Cancel</button>
                </div>
                <p id="passcode-error" style="margin-top: 15px; font-size: 14px; color: #ef4444; display: none;"></p>
            </div>
        </div>

        <!-- Settings Modal -->
        <div id="settings-modal" class="modal" style="display: none;">
            <div class="modal-content">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                    <h2>GitHub Settings</h2>
                    <span id="dev-mode-indicator" style="background: #10b981; color: white; padding: 4px 12px; border-radius: 12px; font-size: 12px; font-weight: bold;">üîì DEV MODE</span>
                </div>
                <p>Configure GitHub integration for saving billboard configurations:</p>

                <!-- GitHub Token -->
                <div class="form-group">
                    <label for="github-token">GitHub Token:</label>
                    <input type="password" id="github-token" class="form-control" placeholder="ghp_xxxxxxxxxxxx">
                    <p class="help-text-small" style="margin-top: 5px;">
                        <a href="https://github.com/settings/tokens/new" target="_blank">Create token here</a>
                        with 'repo' scope
                    </p>
                </div>
                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button id="save-token-btn" class="btn btn-primary">Save Token</button>
                    <button id="clear-token-btn" class="btn btn-danger">Clear Token</button>
                    <button id="close-settings-btn" class="btn btn-secondary">Close</button>
                </div>
                <p id="token-status" style="margin-top: 15px; font-size: 14px;"></p>
            </div>
        </div>

        <main>
            <!-- Tab Selection Section -->
            <section class="tab-selection-section">
                <div class="tabs-container">
                    <button class="tab-btn active" data-tab="static">
                        üì∏ Static Display Banners
                    </button>
                    <button class="tab-btn" data-tab="video">
                        üé¨ In-Game Video Ads
                    </button>
                    <button class="tab-btn disabled" data-tab="ctv" disabled>
                        üì∫ CTV Video Ads
                        <span class="coming-soon-badge">Coming Soon</span>
                    </button>
                </div>
            </section>

            <!-- Game Selection Section -->
            <section class="selection-panel">
                <div class="form-group">
                    <label for="game-select">Select Game:</label>
                    <select id="game-select" class="form-control">
                        <option value="">-- Choose a game --</option>
                    </select>
                </div>
            </section>

            <!-- Screenshot Gallery Section -->
            <section class="gallery-section" id="gallery-section" style="display: none;">
                <h2>Available Screenshots</h2>
                <div class="screenshot-gallery" id="screenshot-gallery">
                    <!-- Gallery items will be populated by JavaScript -->
                </div>
            </section>

            <!-- Editor Section -->
            <section class="editor-section" id="editor-section" style="display: none;">
                <div class="editor-header">
                    <h2>Banner Editor</h2>
                    <button id="back-btn" class="btn btn-secondary">‚Üê Back to Gallery</button>
                </div>

                <div class="editor-container">
                    <div class="editor-canvas-wrapper">
                        <div class="canvas-container">
                            <canvas id="preview-canvas"></canvas>
                        </div>
                    </div>

                    <div class="editor-sidebar">
                        <h3>Upload Banners</h3>
                        <div class="upload-slots-container" id="upload-slots-container">
                            <!-- Dynamic upload slots will be populated here -->
                        </div>

                        <div class="billboard-controls" id="billboard-controls" style="display: none;">
                            <h4>Billboard Selection</h4>
                            <div id="billboard-list">
                                <!-- Billboard buttons will be populated here -->
                            </div>
                        </div>

                        <div class="detected-billboards-list" id="detected-billboards-list" style="display: none;">
                            <h4>Detected Billboards</h4>
                            <p class="help-text-small">Click a billboard to select it</p>
                            <div id="detected-list" class="detected-items">
                                <!-- Detected billboard buttons will be populated here -->
                            </div>
                        </div>

                        <div class="area-selection-controls" id="area-selection-controls" style="display: none;">
                            <h4>Define Billboard Area</h4>
                            <p class="help-text">Select a billboard below, then click to adjust its position, shape, and rounded corners.</p>

                            <div class="form-group" style="margin-bottom: 15px;">
                                <label for="billboard-selector">Select Billboard to Transform:</label>
                                <select id="billboard-selector" class="form-control billboard-selector-dropdown" onchange="console.log('Dropdown changed:', this.value); window.selectBillboardForTransform && window.selectBillboardForTransform(parseInt(this.value));">
                                    <!-- Options populated dynamically -->
                                </select>
                            </div>

                            <button id="start-perspective-mode-btn" class="btn btn-primary" style="width: 100%; margin-bottom: 15px;" onclick="console.log('Edit Billboard Area clicked'); window.startPerspectiveMode && window.startPerspectiveMode();">Edit Billboard Area</button>

                            <button id="add-billboard-btn" class="btn btn-success btn-add-billboard" style="margin-top: 15px;" onclick="console.log('Button clicked!'); window.addNewBillboard && window.addNewBillboard();">
                                <span style="font-size: 1.2em;">+</span> Add Another Billboard
                            </button>

                            <div id="area-adjust-controls" style="display: none;">
                                <p class="coordinates-display">
                                    Position: <span id="area-x">0</span>, <span id="area-y">0</span><br>
                                    Size: <span id="area-width">0</span> √ó <span id="area-height">0</span>px
                                </p>
                                <button id="confirm-area-btn" class="btn btn-success" onclick="console.log('Confirm clicked'); window.confirmAreaSelection && window.confirmAreaSelection();">Confirm Position</button>
                                <button id="cancel-area-btn" class="btn btn-danger" onclick="console.log('Cancel clicked'); window.cancelAreaSelection && window.cancelAreaSelection();">Cancel</button>
                            </div>

                            <div id="perspective-adjust-controls" style="display: none;">
                                <p class="help-text-small">Drag corner handles to position the billboard. Drag blue circles to round corners.</p>
                                <div class="corner-coordinates">
                                    <div class="corner-coord">
                                        <strong>TL:</strong> <span id="corner-tl">0, 0</span>
                                    </div>
                                    <div class="corner-coord">
                                        <strong>TR:</strong> <span id="corner-tr">0, 0</span>
                                    </div>
                                    <div class="corner-coord">
                                        <strong>BL:</strong> <span id="corner-bl">0, 0</span>
                                    </div>
                                    <div class="corner-coord">
                                        <strong>BR:</strong> <span id="corner-br">0, 0</span>
                                    </div>
                                </div>
                                <button id="confirm-perspective-btn" class="btn btn-success" onclick="console.log('Confirm clicked'); window.confirmPerspectiveMode && window.confirmPerspectiveMode();">Confirm</button>
                                <button id="cancel-perspective-btn" class="btn btn-danger" onclick="console.log('Cancel clicked'); window.cancelPerspectiveMode && window.cancelPerspectiveMode();">Cancel</button>
                            </div>

                            <!-- Set as Default buttons (shown after confirm) -->
                            <div id="set-default-container" style="display: none; margin-top: 15px;">
                                <button id="set-default-btn" class="btn btn-primary" onclick="console.log('Set as Default clicked'); window.handleSetAsDefault && window.handleSetAsDefault();">Save to Queue</button>
                            </div>
                        </div>

                        <div class="export-controls" id="export-controls" style="display: none;">
                            <h4>Export</h4>
                            <div id="download-buttons-container">
                                <button id="download-btn" class="btn btn-primary">Download Screenshot</button>
                                <button id="download-video-btn" class="btn btn-primary" style="display: none;">Download Video</button>
                                <button id="download-gif-btn" class="btn btn-primary" style="display: none;">Download GIF</button>
                            </div>
                            <div id="download-progress-container" style="display: none; margin-top: 15px;">
                                <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                    <span id="progress-text">Processing...</span>
                                    <span id="progress-percentage">0%</span>
                                </div>
                                <div style="width: 100%; height: 20px; background: #e0e0e0; border-radius: 10px; overflow: hidden;">
                                    <div id="progress-bar" style="width: 0%; height: 100%; background: linear-gradient(90deg, #4CAF50, #45a049); transition: width 0.3s;"></div>
                                </div>
                                <div id="progress-eta" style="margin-top: 5px; font-size: 0.9rem; color: #666;"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Upload New Screenshot Section -->
            <section class="upload-screenshot-section" style="position: relative;">
                <div style="filter: blur(1.5px); pointer-events: none;">
                    <h3 style="opacity: 0.5;">Or Upload New Screenshot</h3>
                    <p class="help-text" style="opacity: 0.5;">Upload an in-game screenshot and we'll auto-detect billboards</p>
                    <div class="upload-new-screenshot-area" id="upload-new-screenshot-area" style="opacity: 0.3; cursor: not-allowed;">
                        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                            <polyline points="17 8 12 3 7 8"></polyline>
                            <line x1="12" y1="3" x2="12" y2="15"></line>
                        </svg>
                        <p>Click to upload screenshot</p>
                        <p class="upload-hint">JPG, PNG (max 5MB)</p>
                    </div>
                </div>
                <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgba(248, 250, 252, 0.85); padding: 12px 28px; border-radius: 8px; border: 1px solid rgba(203, 213, 225, 0.6); pointer-events: none; backdrop-filter: blur(4px);">
                    <p style="font-size: 16px; font-weight: 600; color: #64748b; margin: 0; text-align: center;">üîí Coming Soon</p>
                </div>
                <input type="file" id="new-screenshot-upload" accept="image/*" style="display: none;" disabled>

                <div id="detection-status" style="display: none; margin-top: 15px;">
                    <p class="status-message">üîç <span id="status-text">Processing...</span></p>
                </div>
            </section>
        </main>

        <footer>
            <p>Ad Banner Screenshot Generator v1.0 | Built for automated adtech workflows</p>
        </footer>
    </div>

    <!-- AI/ML libraries - Disabled until "Upload Screenshot" feature is ready -->
    <!-- <script src="https://cdn.jsdelivr.net/npm/onnxruntime-web@1.16.3/dist/ort.min.js"></script> -->
    <!-- <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.11.0/dist/tf.min.js"></script> -->
    <!-- <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/coco-ssd@2.2.3/dist/coco-ssd.min.js"></script> -->
    <!-- <script async src="https://docs.opencv.org/4.8.0/opencv.js" onload="onOpenCvReady();" type="text/javascript"></script> -->
    <!-- <script src="js/custom-model.js"></script> -->
    <!-- <script src="js/detection.js"></script> -->

    <script src="https://cdn.jsdelivr.net/npm/gif.js@0.2.0/dist/gif.js"></script>
    <script src="js/video-processor.js"></script>
    <script src="js/app.js"></script>
</body>
</html>
